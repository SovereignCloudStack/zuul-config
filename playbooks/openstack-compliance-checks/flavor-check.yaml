---
- hosts: all
  tasks:
    - name: Install collection openstack.cloud
      community.general.ansible_galaxy_install:
        type: collection
        name: community.cloud

    - name: Create cloud config dir
      ansible.builtin.file:
        path: "~/.config/openstack"
        state: directory
        recurse: true
        mode: "0700"

    - name: Create cloud config file
      ansible.builtin.copy:
        content: "{{ clouds_conf.credentials }}"
        dest: "~/.config/openstack/clouds.yaml"
        mode: "0600"
      no_log: true

    - name: List compute flavors
      openstack.cloud.resources:
        cloud: devstack-admin
        service: compute
        type: flavor
      register: flavors

    - name: Print return information from the previous task
      ansible.builtin.debug:
        var: flavors